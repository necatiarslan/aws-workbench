# AWS Workbench – AI Guide
- Purpose: VS Code extension exposing AWS resources in a single tree view; entrypoint activates Session, ServiceHub, TreeView, then loads/saves tree state [src/extension.ts](src/extension.ts), [src/tree/TreeView.ts](src/tree/TreeView.ts), [src/tree/TreeState.ts](src/tree/TreeState.ts).
- Build/run: install deps with npm; compile once via `npm run compile`, live rebuild with `npm run watch`, lint with `npm run lint`, extension tests with `npm test` (uses @vscode/test-electron), publish flow uses `npm run vscode:prepublish`.
- Tree architecture: all nodes extend [src/tree/NodeBase.ts](src/tree/NodeBase.ts); constructor auto-attaches to parent or RootNodes and triggers TreeProvider refresh; use event emitters (OnNodeAdd/Remove/Refresh/View/Edit/Run/Stop/Open/Info/LoadChildren) instead of overriding methods; call TreeState.save after mutations.
- Visibility/filtering: NodeBase.SetVisible honors Session filters (favorite, hidden, profile, workspace, text filter) and propagates to children; TreeView toggles flags and refreshes view.
- Context menus: NodeBase builds `contextValue` with tags (#AddFav#, #Hide#, #NodeRun#, etc.); package.json menus rely on these tags—update SetContextValue when adding new actions; node alias support gated by EnableNodeAlias.
- Serialization/persistence: mark fields with @Serialize to persist; register every node class with NodeRegistry to allow restore; TreeSerializer walks children and skips unregistered node types; TreeState.save is debounced 500ms, saveImmediate runs on deactivate; export/import uses JSON via TreeState.
- Busy state: call StartWorking/StopWorking to swap icon to loading spinner and refresh; IsAwsResourceNode tracks AWS-bound nodes for ancestor lookups.
- Session/certs: Session stores profile, region, endpoint, filters in globalState and caches AWS credentials via fromNodeProviderChain; SetAwsProfile/SetAwsRegion/SetAwsEndpoint clear credentials; TestAwsConnection calls STS GetCallerIdentity [src/common/Session.ts](src/common/Session.ts).
- Services: ServiceHub instantiates FileSystemService, S3Service, CloudWatchLogService, LambdaService, VscodeService and exposes singletons [src/tree/ServiceHub.ts](src/tree/ServiceHub.ts); commands delegate to service Add methods for root additions.
- S3 pattern: S3Service.Add prompts for bucket(s) then creates S3BucketNode children; S3BucketNode uses aliases, shortcut group child, and TreeState.save on changes [src/s3/S3Service.ts](src/s3/S3Service.ts), [src/s3/S3BucketNode.ts](src/s3/S3BucketNode.ts).
- S3 API: wrappers in [src/s3/API.ts](src/s3/API.ts) return MethodResult, use cached S3 client with Session endpoint/region and forcePathStyle; deletion copies respect folder vs file; StartConnection/StopConnection manage cached client/credentials.
- Lambda pattern: LambdaService.Add prompts region, lists functions, creates LambdaFunctionNode with Region set; node wires NodeRun->TriggerLambda (optional payload prompt or file), NodeInfo -> open JSON config; default children: code/env/info/logs/tags/triggers nodes [src/lambda/LambdaService.ts](src/lambda/LambdaService.ts), [src/lambda/LambdaFunctionNode.ts](src/lambda/LambdaFunctionNode.ts).
- Lambda API: [src/lambda/API.ts](src/lambda/API.ts) wraps AWS SDK clients, supports listing, invoking, fetching logs via CloudWatch Logs helpers; many helpers expect Session.Current credentials and optional endpoint.
- CloudWatch logs: CloudWatchLogService.Add prompts region, log groups, creates CloudWatchLogGroupNode/Stream nodes; relies on TreeState.save for persistence [src/cloudwatch-logs/CloudWatchLogService.ts](src/cloudwatch-logs/CloudWatchLogService.ts).
- Filesystem nodes: FileNode stores FileName/FilePath, OnNodeOpen calls ui.openFile, persists via @Serialize and NodeRegistry registration [src/filesystem/FileNode.ts](src/filesystem/FileNode.ts).
- UI utilities: use ui.logToOutput for diagnostic channel (AwsWorkbench-Log) and ui.showOutputMessage for user-facing output; helper includes sleep, bytesToText, date checks, clipboard helpers [src/common/UI.ts](src/common/UI.ts).
- Telemetry hooks: Telemetry.Current?.send(...) sprinkled in services/nodes; ensure any new telemetry events follow existing pattern before/after actions.
- Icons: custom AWS codicon font defined in package.json `icons`; set NodeBase.Icon to key (e.g., s3-bucket, lambda-function) to display.
- Commands/view: TreeView registers all AwsWorkbench.* commands; view container/activity bar id AwsWorkbench, main view id AwsWorkbenchView configured in package.json (menus, view/title buttons, view welcome text).
- Persistence UX: export/import commands save JSON via TreeState; loading clears RootNodes then finalizes nodes (expands root children automatically) [src/tree/TreeState.ts](src/tree/TreeState.ts).
- Error handling: MethodResult pattern (isSuccessful, result, error) throughout AWS API wrappers; surface errors with ui.showErrorMessage + ui.logToOutput for consistency.
- When adding a new node type: extend NodeBase, set Icon/context tags, wire EventEmitter handlers instead of overriding, mark persisted fields with @Serialize, register with NodeRegistry, call TreeState.save after structural changes, and ensure visibility rules align with Session filters.

Let me know if any section needs more detail or if other subsystems should be covered (e.g., specific webviews under media/).
